helios:
  schema_version: "0.1"
  default_domain: "facility"

pipeline:
  intent:
    # Optional JSONL path; if absent, seeds are used for synthetic runs.
    path: null
    seed_intents:
      - id: "intent_demo_hold"
        text: "Hold position near Line Bravo and conserve battery."
        domain: "sea"
        desired_effects: ["hold", "conserve_power"]
        constraints: ["stay_within_line_bravo"]
        timing: "immediate"
        priority: "high"
  playbook:
    intents:
      - match:
          contains: "hold"
        action: "hold_position"
        parameters:
          hold_radius_m: 200
        rationale: "Map hold language to a hold_position playbook action."
      - match:
          contains: "move"
        action: "move_sector"
        parameters:
          distance_m: 5000
        rationale: "Map move language to a sector move placeholder."
  platform:
    queue_path: "out/platform_commands.q.jsonl"
    link_states:
      - target: "sea_unit"
        available: true
        last_check_epoch: 0
        notes: "demo link"
      - target: "drone_alpha"
        available: true
        last_check_epoch: 0
        notes: "mesh link stable"
        metrics:
          rssi: -62
      - target: "drone_bravo"
        available: false
        window_ends_epoch: 0
        last_check_epoch: 0
        notes: "reacquire after terrain mask"
        metrics:
          packet_loss: 0.35
    assets:
      - id: "drone_alpha"
        domain: "air"
        vehicle_type: "quadcopter"
        label: "Raven-Alpha"
        status: "available"
        battery_pct: 0.86
        comm_link:
          link: "mesh"
          strength: 0.78
        route:
          - { lat: 34.0525, lon: -118.2442, alt_m: 120, eta_epoch: 0 }
      - id: "drone_bravo"
        domain: "air"
        vehicle_type: "quadcopter"
        label: "Raven-Bravo"
        status: "tasked"
        battery_pct: 0.58
        comm_link:
          link: "sat"
          strength: 0.61
        route:
          - { lat: 34.0521, lon: -118.2455, alt_m: 90, eta_epoch: 0 }
      - id: "wing_charlie"
        domain: "air"
        vehicle_type: "fixed_wing"
        label: "Wing-Charlie"
        status: "link_only"
        battery_pct: 0.92
        comm_link:
          link: "sat"
          strength: 0.9
        route: []
  rules_config: "configs/rules.sample.yaml"
  export:
    formats: ["json", "metrics"]
    webhook: null  # { url: "https://example.com/hook", timeout_seconds: 5, retries: 2, backoff_seconds: 1, dlq_path: "out/webhook.dlq" }
    task_jsonl: null  # { path: "out/tasks.jsonl", rotate_max_bytes: 1048576 }
    infrastructure:  # Simulated defensive infrastructure export (JSONL + optional HTTP forward)
      path: "out/infrastructure_actions.jsonl"
      rotate_max_bytes: 1048576
      http: null  # { url: "http://localhost:5000/mock", timeout_seconds: 5, retries: 1, backoff_seconds: 1 }
      dlq_path: "out/infrastructure_http.dlq"
    metrics:
      path: "out/metrics.prom"
  ingest:
    mode: "scenario"  # or "tail"
    tail:
      path: "examples/scenario_minimal.jsonl"
      max_items: 100
      poll_interval_sec: 0.05
    media:
      path: "examples/scenario_minimal.yaml"  # used when mode: modules_media
      stride: 8
    modules:
      enable_vision: true
      enable_audio: true
      enable_thermal: true
      enable_gait: true
      enable_scene: true
      downscale: 0.75
  governance:
    forbid_actions: ["unauthorized_strike"]
    block_domains: []
    block_categories: []
    severity_caps: {}
  human_loop:
    default_require_approval: true
    domain_require_approval: []
    auto_approve: true
    approver: "auto-approver"
    allow_unsigned_auto_approve: true
  guardrails:
    rate_limits:
      per_domain: {}
      total: null
      per_event: null
      per_asset_infra: {}
      per_asset_infra_patterns: []  # [{ pattern: "door_*", limit: 5 }]
    health_alert_drop_ratio: 0.5
    risk_budgets:
      default:
        critical_limit: 5
    risk_backoff_base_sec: 10
    risk_window_sec: 300
    risk_store_path: "out/risk_store.sqlite"
  rbac:
    approvers:
      - id: "auto"
        secret: "changeme"
        roles: ["ops"]
    min_approvals: 0
    active_approver: {}
    active_approvers: []
    required_roles: {}
    action_requirements:
      lock:
        required_roles: ["sec"]
        min_approvals: 1
      unlock:
        required_roles: ["sec"]
        min_approvals: 1
      notify_emergency_services:
        required_roles: ["sec"]
        min_approvals: 1
  infrastructure:
    action_defaults:
      lock:
        required_roles: ["sec"]
        min_approvals: 1
      unlock:
        required_roles: ["sec"]
        min_approvals: 1
      notify_emergency_services:
        required_roles: ["sec"]
        min_approvals: 1
    mappings:
      - match:
          category: "facility_intrusion"
          domain: "facility"
        tasks:
          - action: "lock"
            asset_id: "gate_alpha"
            infrastructure_type: "gate"
            rationale: "Contain intrusion at perimeter"
            assignee_domain: "facility"
            priority: 1
            requires_approval: true
          - action: "notify_security"
            asset_id: "sec_ops"
            infrastructure_type: "emergency_channel"
            rationale: "Alert security of intrusion"
            assignee_domain: "facility"
            priority: 1
            requires_approval: false
      - match:
          category: "fire_alert"
          domain: "facility"
        tasks:
          - action: "unlock"
            asset_id: "bldg_a_main_door"
            infrastructure_type: "door"
            rationale: "Enable egress for fire response"
            assignee_domain: "facility"
            priority: 1
            requires_approval: false
          - action: "notify_emergency_services"
            asset_id: "fire_dispatch"
            infrastructure_type: "emergency_channel"
            rationale: "Alert fire services"
            assignee_domain: "facility"
            priority: 1
            requires_approval: true
tenant:
  id: "default"

severity:
  info: 1
  notice: 2
  warning: 3
  critical: 4

audit:
  actor: "system"
  sign_secret: "changeme"
  verify_on_start: true
  require_signing: false
